---
title: "Unit 4 BIO144 Course Content"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```


## Introduction

On this web page you will find the homework, practical exercises and weekly quiz for Unit 4 of BIO144.

All other information for the course is on the OLAT course webpages, and web pages linked to from there: [OLAT BIO144 Info. Hub](https://lms.uzh.ch/auth/RepositoryEntry/17827987490/CourseNode/112943793799740)


## Homework

All homework is for your own practice and learning. It will not be marked or graded.

### Homework common to all weeks:**

* Review the material from the lecture(s) this week. Make sure you understand the concepts and ideas presented. Ensure you can follow any mathematical or statistical explanations. Ensure you can do the R that is needed for the week's learning objectives.

* When you find things you don't understand or have trouble doing (e.g., in R), make a note of these. You can then ask a teaching assistant (TA) for help during the practical session, and you can ask on the Discussion Forum on OLAT. You can also ask questions during the lectures.

### Reading

Finish reading section 5.5 of Beckerman, Childs, and Petchey.

### Video walkthrough

You started watching a video walkthrough of regression in R during the previous Unit. In the video below you can continue watching. The video will automatically start at 9 min 15 sec, since before that is not so relevant.

<iframe width="560" height="315" src="https://www.youtube.com/embed/e2gJtXbQsdw?si=4OuLIgsYsInN6FIt&amp;start=555" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


### Seeing theory

[This amazing website is a visual introduction to probability and statistics](https://seeing-theory.brown.edu/). It is worth exploring this website to help you understand some of the statistical ideas we cover in this course. [Here is the section on regression](https://seeing-theory.brown.edu/#secondPage/chapter6).


## Practical part 1

### Interpreting regression results

Last week we worked with the financing healthcare dataset. We will continue working with this dataset this week.

Bring up your script from last week. It should already include:

* Loading the dataset.
* Some initial exploration of the dataset.
* Some initial plots of the dataset.
* Fitting a linear model to the dataset.
* Checking the assumptions of the linear model.

Now that we have checked the assumptions of the linear model, we can interpret the results of the model. We need to look at a few things:

* The slope.
* The intercept.
* The amount of variability explained.
* The statistical significance.
* The degrees of freedom for error.

---

**However, stop! Before you continue, make guesses of the intercept, slope, significance, and degrees of freedom for error. Write your guesses down somewhere. Do not move on until you have done this!**

---

We can get all of these with one function in R: `summary()`. Add this to your script, run it, and work through the following questions.

```{r quiz-estimated-intercept, echo=FALSE}
learnr::question_numeric(
  "What is the estimated intercept (of the regression on all 186 data points)?\n\n(Give your answer rounded to two decimal places.)",
  
  learnr::answer(3.29, correct = TRUE),
  
  correct = "Correct! The estimated intercept is 3.29.",
  incorrect = "Not quite. Check the fitted regression output and report the intercept rounded to two decimal places.",
  allow_retry = TRUE
)
```

```{r quiz-estimated-slope, echo=FALSE}
learnr::question_numeric(
  "What is the estimated slope (of the regression on all 186 data points)?\n\n(Give your answer rounded to two decimal places.)",
  
  learnr::answer(-0.76, correct = TRUE),
  
  correct = "Correct! The estimated slope is −0.76.",
  incorrect = "Not quite. Check the fitted regression output and report the slope rounded to two decimal places.",
  allow_retry = TRUE
)
```

A true story... when Prof. Petchey wrote this practical, he did exactly what he's now advising you: make a guess of the slope from the graph, and then use `lm()` to calculate the slope. However, he found that they were quite different! The guessed slope was about -0.75 but the value given by lm was around -1.0. This was too big a difference to ignore! It was like an alarm bell ringing, that something was probably wrong. Prof. Petchey found that he'd got the response and explanatory variable in the lm switched the wrong way round. Fixing this made the calculated slope also about -0.75.

This is a real example of how making a guess before doing the analysis and comparing this to the calculated value provides us with a method for cross checking our work. If we always build in such cross checks, we will much more frequently spot our mistakes. And if there is one thing that's certain... we will make mistakes!

```{r quiz-r-squared, echo=FALSE}
learnr::question_numeric(
  "What fraction (rounded to two decimal places) of the variation in log child mortality is explained?",
  
  learnr::answer(0.76, correct = TRUE),
  
  correct = "Correct! About 0.76 (76%) of the variation in log child mortality is explained by the model.",
  incorrect = "Not quite. Look at the model summary and report the proportion of variance explained (R-squared), rounded to two decimal places.",
  allow_retry = TRUE
)
```

```{r quiz-slope-zero-compatibility, echo=FALSE}
learnr::question(
  "Would you say that a slope value of zero is not compatible with the data?",
  
  learnr::answer("yes", correct = TRUE),
  learnr::answer("no"),
  
  correct = "Correct! The estimated slope is clearly different from zero, indicating a strong relationship that is not compatible with a slope of zero.",
  incorrect = "Look again at the estimated slope and how much variation is explained by the model. A slope of zero would not be consistent with these results.",
  allow_retry = TRUE
)
```

```{r quiz-df-error-r-output, echo=FALSE}
learnr::question_numeric(
  "How many degrees of freedom for error does R tell us there are?",
  
  learnr::answer(184, correct = TRUE),
  
  correct = "Correct! R reports 184 degrees of freedom for error.",
  incorrect = "Not quite. Look at the model summary output and find the reported degrees of freedom for error.",
  allow_retry = TRUE
)
```


**Checking back**: You made and wrote down guesses of the intercept, slope, significance, and degrees of freedom for error. Were your guesses close to the estimated values? Mine were very close. So in this case, we didn't gain any qualitative information from the regression, but we did gain some quantitative confirmation of what we already new. This is often the case for simple problems, like regression: we can see just as much from looking at the data as we can from a formal regression analysis. We do both, as then we can be more confident in our results. We should never trust only looking at our data, and we should never trust only doing an statistical test. We always should do both and compare them.


### Reporting the results

When reporting the results of a regression analysis, it is important to focus on the key components that convey the most meaningful information about the relationship being studied.

```{r quiz-good-reporting-sentence, echo=FALSE}
learnr::question(
  "Which of the following best describes the key components *and their priorities* in a good reporting sentence for a regression analysis?",
  
  learnr::answer(
    "Report the p-value first, followed by the exact R code used, and then the estimated slope.",
    correct = FALSE
  ),
  learnr::answer(
    "State whether the relationship is statistically significant, then give the p-value, and finally mention the direction of the effect.",
    correct = FALSE
  ),
  learnr::answer(
    "Describe the direction and size of the relationship, give a measure of uncertainty (e.g. confidence interval or standard error), and then provide relevant model context (e.g. sample size or R²).",
    correct = TRUE
  ),
  learnr::answer(
    "List all estimated coefficients, all p-values, and all diagnostic test results in one sentence.",
    correct = FALSE
  ),
  learnr::answer(
    "Give the R² value only, as this summarises how good the model is.",
    correct = FALSE
  ),
  learnr::answer(
    "Explain the biological background first, then show the regression equation, and omit numerical results to keep the text readable.",
    correct = FALSE
  ),
  
  correct = "Correct! A good reporting sentence prioritises the direction and size of the effect, includes a measure of uncertainty, and provides just enough statistical context for interpretation.",
  incorrect = "Think about what a reader needs first to understand the result: what happened, how big the effect is, and how certain we are — not just whether p < 0.05.",
  allow_retry = TRUE
)
```

```{r quiz-reporting-pattern-loglog, echo=FALSE}
learnr::question(
  "Which of these should we include in a statement about the pattern?\n\nOn a log–log scale, there was a ??1?? and ??2?? relationship between child mortality and health care spending, with approximately ??3?? unit of difference in log health care spent corresponding to ??4?? unit change in log child mortality.\n\nA. -1\nB. 1\nC. negative\nD. linear\nE. positive\nF. non-linear",
  
  learnr::answer("??1?? = D, ??2?? = B; ??3?? = C; ??4?? = A"),
  learnr::answer("??1?? = D, ??2?? = C; ??3?? = B; ??4?? = A", correct = TRUE),
  learnr::answer("??1?? = B, ??2?? = A; ??3?? = C; ??4?? = D"),
  learnr::answer("??1?? = A, ??2?? = B; ??3?? = C; ??4?? = D"),
  
  correct = "Correct! On the log–log scale the relationship is linear and negative, with about a 1-unit increase in log health care spending corresponding to a −1-unit change in log child mortality.",
  incorrect = "Think about both the *form* (linear vs non-linear) and the *direction* (positive vs negative), and then how to describe the size of the change in log–log terms.",
  allow_retry = TRUE
)
```

```{r quiz-reporting-statistical-test, echo=FALSE}
learnr::question(
  "Which of these is an appropriate statement about the statistical test we performed?\n\nThe statements are in parentheses, as this is how we would typically include them in a report, at the end of the sentence about the pattern.\n\n(Hint: the negative sign of the t-value in the summary table can be ignored.)",
  
  learnr::answer("(linear regression, t = 37.7, p < 0.0001)"),
  learnr::answer("(linear regression, p < 0.0001)"),
  learnr::answer("(linear regression, 38 degrees of freedom for error, t = 176.7, p < 0.0001, r-squared = 0.76)"),
  learnr::answer(
    "(linear regression, 184 degrees of freedom for error, t = 24.1, p < 0.0001, r-squared = 0.76)",
    correct = TRUE
  ),
  
  correct = "Correct! This statement reports the test type, degrees of freedom, test statistic, p-value, and R², which together provide a complete and appropriate summary of the statistical test.",
  incorrect = "Think about what information is needed for a complete statistical report: the type of test, degrees of freedom, test statistic, p-value, and a measure of explanatory power.",
  allow_retry = TRUE
)
```

So this would be our sentence reporting the results:

*On a log-log scale, there was a negative and linear relationships between child mortality and health care spending, with approximately 1 unit of difference in log health care spend corresponding to -1 unit change in log child mortality (linear regression, 184 degrees of freedom for error, t = 24.1, p < 0.0001).*

### Reporting graphically


Make a beautiful graph that you would be happy publishing, for all the world to see. (Use the x and y log transformed data still.)

Ensure:

* Appropriate size and dimensions of all elements.
* Appropriate axis labels with units of measurement.
* Appropriate text size and point sizes.
* Include the regression line with a confidence interval band.

Special distinction if you can:

* Add some labels to the data points, so one can see which countries are which.
* Colour the points by continent, and include a graphical key.


### A linear-linear graph

A thorny issue remains! We have reported our results based on analysis of the log transformed data. For the purposes of you learning about regression, this is just fine. You learned what can be applied in all cases.

However, there is an extra step that we should at least think about: what do our findings imply about the relationship between the untransformed variables? This is quite relevant, because we're often interested in money, not log transformed money, and child mortality, and not log transformed child mortality.

Here is the graph of the data and regression line back on the raw (untransformed axes) (the code to make this is at the bottom of this page):

```{r untransformed-graph, echo=FALSE, fig.width=6, fig.height=4, warning=FALSE}
fh_data <- suppressMessages(readr::read_csv("https://raw.githubusercontent.com/opetchey/BIO144_Practicals_WAs/refs/heads/main/assets/datasets/financing_healthcare.csv",show_col_types = FALSE))
fh_2013 <- fh_data |>
  dplyr::filter(year == 2013) |>
  dplyr::select(country, health_exp_total, child_mort) |>
  tidyr::drop_na() |> 
  dplyr::mutate(
    log_health_exp_total = log10(health_exp_total),
    log_child_mort = log10(child_mort)
  )
mod1 <- lm(log_child_mort ~ log_health_exp_total, data = fh_2013)
new_data <- data.frame(
  health_exp_total = seq(min(fh_2013$health_exp_total), max(fh_2013$health_exp_total), length.out = 100)
)
new_data <- new_data |> 
  dplyr::mutate(
    log_health_exp_total = log10(health_exp_total)
  )
preds <- predict(mod1, newdata = new_data, interval = "confidence")
new_data <- new_data |> 
  dplyr::mutate(
    log_child_mort_fit = preds[, "fit"],
    log_child_mort_lwr = preds[, "lwr"],
    log_child_mort_upr = preds[, "upr"],
    child_mort_fit = 10^(log_child_mort_fit),
    child_mort_lwr = 10^(log_child_mort_lwr),
    child_mort_upr = 10^(log_child_mort_upr)
  )
library(ggplot2)
ggplot() +
  geom_point(data = fh_2013, mapping = aes(x = health_exp_total, y = child_mort)) +
  geom_line(data = new_data, aes(x = health_exp_total, y = child_mort_fit), color = "blue") +
  geom_ribbon(data = new_data, aes(x = health_exp_total, ymin = child_mort_lwr, ymax = child_mort_upr), alpha = 0.2) +
  #scale_x_log10() +
  #scale_y_log10() +
  labs(
    x = "Health Expenditure per Capita (USD)",
    y = "Child Mortality (deaths per 1,000 live births)",
    title = "Relationship between Health Expenditure and Child Mortality"
  ) 
```


```{r quiz-interpret-nonlinearity-spend, echo=FALSE}
learnr::question(
  "This graph tells us some new things.\n\nFor example, which of these seems true?",
  
  learnr::answer(
    "When health care spending is relatively high, say greater than 2000 dollars per capita per year, there is a weak / shallow relationship with child mortality.",
    correct = TRUE
  ),
  learnr::answer("The slope of the relationship seems independent of health care spending."),
  learnr::answer("When health care spending is relatively low, there is a weak and shallow relationship with child mortality."),
  
  correct = "Correct! At higher levels of health care spending, increases in spending are associated with relatively small changes in child mortality, indicating a weaker or shallower relationship.",
  incorrect = "Look carefully at how the slope appears to change across different levels of health care spending. The relationship is not constant across the full range.",
  allow_retry = TRUE
)
```

### Policy implications and recommendations

Analyses such as the one you did can be important for influencing policy, such as whether to increase or decrease spending on healthcare.

Do you think it would be appropriate, based on these analyses, to recommend that a country with healthcare spending above about 2'000 dollars per capita per year should not prioritise increases in healthcare spending, as this would lead to little if any decrease in child mortality?

The answer is that one would have to be very cautious, in the least. And perhaps avoid this altogether.

```{r quiz-causation-vs-correlation, echo=FALSE}
learnr::question(
  "Which of these is the **most important reason** that we cannot assume that a change in health care spending will result in a change in child mortality?",
  
  learnr::answer("many other factors can affect child mortality."),
  learnr::answer(
    "the data is observational, i.e. is a correlation.",
    correct = TRUE
  ),
  learnr::answer("the relationship is weak."),
  learnr::answer("we don't know exactly how the data were collected."),
  
  correct = "Correct! Because the data are observational, we can identify associations but cannot confidently infer causation.",
  incorrect = "While other factors, data quality, and relationship strength matter, the key issue is that observational data do not allow causal conclusions.",
  allow_retry = TRUE
)
```







### Code to make the untransformed graph

```{r untransformed-graph-code, eval = FALSE, echo = TRUE}
fh_data <- read_csv("financing_healthcare.csv")
fh_2013 <- fh_data |>
  dplyr::filter(year == 2013) |>
  dplyr::select(country, health_exp_total, child_mort) |>
  tidyr::drop_na() |> 
  dplyr::mutate(
    log_health_exp_total = log10(health_exp_total),
    log_child_mort = log10(child_mort)
  )
mod1 <- lm(log_child_mort ~ log_health_exp_total, data = fh_2013)
new_data <- data.frame(
  health_exp_total = seq(min(fh_2013$health_exp_total), max(fh_2013$health_exp_total), length.out = 100)
)
new_data <- new_data |> 
  dplyr::mutate(
    log_health_exp_total = log10(health_exp_total)
  )
preds <- predict(mod1, newdata = new_data, interval = "confidence")
new_data <- new_data |> 
  dplyr::mutate(
    log_child_mort_fit = preds[, "fit"],
    log_child_mort_lwr = preds[, "lwr"],
    log_child_mort_upr = preds[, "upr"],
    child_mort_fit = 10^(log_child_mort_fit),
    child_mort_lwr = 10^(log_child_mort_lwr),
    child_mort_upr = 10^(log_child_mort_upr)
  )
ggplot() +
  geom_point(data = fh_2013, mapping = aes(x = health_exp_total, y = child_mort)) +
  geom_line(data = new_data, aes(x = health_exp_total, y = child_mort_fit), color = "blue") +
  geom_ribbon(data = new_data, aes(x = health_exp_total, ymin = child_mort_lwr, ymax = child_mort_upr), alpha = 0.2) +
  #scale_x_log10() +
  #scale_y_log10() +
  labs(
    x = "Health Expenditure per Capita (USD)",
    y = "Child Mortality (deaths per 1,000 live births)",
    title = "Relationship between Health Expenditure and Child Mortality"
  ) 
```



## Weekly Quiz



```{r q6-predict, echo=FALSE}
learnr::question(
  "Which function in R is very useful for getting fitted values of the response variable from a fitted model, for some new values of the explanatory variables?",
  
  learnr::answer(
    "predict",
    correct = TRUE
  ),
  learnr::answer("fitted"),
  learnr::answer("residuals"),
  learnr::answer("summary"),
  
  correct = "Correct! predict() is used to obtain fitted (or predicted) values from a model, including for new data.",
  incorrect = "predict() is the general-purpose function for generating predictions from fitted models.",
  allow_retry = TRUE
)
```

```{r q7-confidence-vs-prediction, echo=FALSE}
learnr::question(
  "After a linear regression model has been fitted, it is possible to plot **confidence** and **prediction** bands.\n\nWhich of the two bands is wider, and why?\n\n(Only one correct answer.)",
  
  learnr::answer(
    "The prediction band is wider, because it has to account only for the uncertainty in the coefficients and σ²."
  ),
  learnr::answer(
    "The confidence band is wider, because it has to account only for the uncertainty in the coefficients and σ²."
  ),
  learnr::answer(
    "The confidence band is wider, because it has to account for two sources of uncertainty, namely in the coefficients and σ²."
  ),
  learnr::answer(
    "The prediction band is wider, because it has to account for two sources of uncertainty, namely in the coefficients and σ², and in the error term εᵢ.",
    correct = TRUE
  ),
  
  correct = "Correct! Prediction intervals are wider because they include both uncertainty in the estimated mean and the additional variability of individual observations.",
  incorrect = "Prediction intervals always include more uncertainty than confidence intervals.",
  allow_retry = TRUE
)
```


```{r q-interpret-slope, echo=FALSE}
learnr::question(
  "In a simple linear regression, what does the estimated slope represent?",
  
  learnr::answer("The average value of the response variable."),
  learnr::answer(
    "The expected change in the response variable for a one-unit increase in the explanatory variable.",
    correct = TRUE
  ),
  learnr::answer("The strength of the correlation between the two variables."),
  learnr::answer("The proportion of variance explained by the model."),
  
  correct = "Correct! The slope describes how much the response variable is expected to change, on average, for a one-unit increase in the explanatory variable.",
  incorrect = "Think about what the slope measures in terms of changes in x and corresponding changes in y.",
  allow_retry = TRUE
)
```

```{r q-calc-r-squared-ss, echo=FALSE}
learnr::question_numeric(
  "Suppose that for a simple linear regression you are given the following information:\n\n- Total sum of squares (SST) = 500\n- Residual sum of squares (SSR, i.e. sum of squared residuals) = 120\n\n (Give your answer as a decimal with two decimal places.)",
  
  learnr::answer(0.76, correct = TRUE),
  
  correct = "Correct! R² = 1 − (120 / 500) = 1 − 0.24 = 0.76.",
  incorrect = "Not quite. Use the formula R² = 1 − (SSR / SST), and be careful to divide the residual sum of squares by the total sum of squares.",
  allow_retry = TRUE
)
```

```{r q-calc-slope-ss, echo=FALSE}
learnr::question_numeric(
  "Suppose you are fitting a simple linear regression model and are given the following summary quantities:\n\n- Sum of squares of x about its mean: Sxx = 200\n- Sum of cross-products of x and y about their means: Sxy = −152\n\nWhat is the value of the estimated slope? (Give your answer rounded to two decimal places.)",
  
  learnr::answer(-0.76, correct = TRUE),
  
  correct = "Correct! The slope is β₁ = −152 / 200 = −0.76.",
  incorrect = "Not quite. Use the formula β₁ = Sxy / Sxx, and remember to divide the cross-product sum by the sum of squares of x.",
  allow_retry = TRUE
)
```


```{r q-calc-predicted-value, echo=FALSE}
learnr::question_numeric(
  "Suppose you have fitted the following simple linear regression model:\n\nŷ = 3.29 − 0.76x\n\nWhat is the predicted value of y when x = 2.0?\n\n(Give your answer rounded to two decimal places.)",
  
  learnr::answer(1.77, correct = TRUE),
  
  correct = "Correct! Substituting x = 2.0 into the model gives ŷ = 3.29 − 0.76 × 2.0 = 1.77.",
  incorrect = "Not quite. Substitute x = 2.0 into the regression equation and evaluate carefully.",
  allow_retry = TRUE
)
```

```{r q-calc-ci-slope, echo=FALSE}
learnr::question_numeric(
  "Suppose you have fitted a simple linear regression model and obtained the following results:\n\n- Estimated slope (β₁) = −0.76\n- Standard error of the slope = 0.05\n- Degrees of freedom are large enough that the 95% critical value is approximately 1.96\n\nWhat is the **lower bound** of the 95% confidence interval for the slope?\n\n(Give your answer rounded to two decimal places.)",
  
  learnr::answer(-0.86, correct = TRUE),
  
  correct = "Correct! The lower bound is −0.76 − (1.96 × 0.05) ≈ −0.86.",
  incorrect = "Not quite. Use the formula β₁ − (1.96 × SE) and round the result to two decimal places.",
  allow_retry = TRUE
)
```

```{r q-definition-pvalue-slope, echo=FALSE}
learnr::question(
  "In a simple linear regression, what does the **p-value associated with the slope coefficient** represent?",
  
  learnr::answer(
    "The probability that the slope is exactly zero.",
    correct = FALSE
  ),
  learnr::answer(
    "The probability that the null hypothesis is true.",
    correct = FALSE
  ),
  learnr::answer(
    "The probability of observing a slope estimate at least as extreme as the one obtained, **if the true slope were zero**.",
    correct = TRUE
  ),
  learnr::answer(
    "The probability that the explanatory variable causes changes in the response variable.",
    correct = FALSE
  ),
  learnr::answer(
    "The proportion of variance in the response variable explained by the slope.",
    correct = FALSE
  ),
  
  correct = "Correct! The p-value is the probability of observing a slope estimate as extreme as (or more extreme than) the one obtained, assuming the null hypothesis that the true slope is zero.",
  incorrect = "Be careful: the p-value is defined *conditional on the null hypothesis being true*. It does not give the probability that the null hypothesis is true.",
  allow_retry = TRUE
)
```



